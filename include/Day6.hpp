#include <iostream>
#include<fstream>
#include <algorithm>
#include <ranges>
#include <string_view>
#include <vector>
#include <numeric>
#include <set> // or <unordered_set>
#include <utility>
#include <unordered_set> 
using namespace std::string_view_literals;

#pragma region
constexpr auto input6 = 
R"(
..........................#.#........................................#..........................................#.............#...
....................#...............................#.......#...............................#..........................#...#......
.....#.......#...................................................#..#....................##.........#...#...........#.....#..#.#..
............#...#....#..............##...#.#....#........................#...................................................#....
....#......##........................................................................#..#..##...................##.........#......
.............##.........#..##..............#...............#....................#..................#......#...................#...
...........#.....................#.......#.................#....#.#..............#...........#.........................#..........
.#............#..............................................................#........#................#........#.................
..........................#..#.......................................................#.........#..................................
.........#....#................#...........#...................##............#..........#.........................................
....#...................................#....#.........#..........#.......................#..............................#........
.............................#.....##.............................................................#..#...........................#
....#................#...#.#..........#.#....#..................#..........#......#.............................#.................
......................#............#......................................##................#..........#..#.............#.........
..#........#............#.....###....##...........................#..............................#.....#..........................
.....#...........#..#.........#...................#.#.................#........#............#.....#........#......................
..........................................................................................................................#.......
..#...................#.....................................................................#....................#................
...............#............................#....#..........#...................#............#...............#..#.................
................#...........................#...........................................#.........................#...............
..........#.......#.........................##.................................................#...................##..#..........
.#.........#...#..#............................................#........................#.......................................#.
........#...........###..................#...........#..............#.....................#................#......................
.............#....#............................#.#..............................#..#................................#.............
...#.....#..........#...........#..................................................#........#...........#..#..........##.....#....
...............................................................................#...................#........................##....
......#.#...........................#.................#.................................................................#.........
..................................#............................................................................#.#................
........................#.......#.....#..........#..#.............##.................#..............#............##...............
......#........................#........................................#......#..................................................
...............##.......#..............................................................................................#..........
....#...................................................................................#.........#..........#..............#.....
.....#.............#.........................#.........#........#................#.#.........................#..........#.........
.............#......##...........#................#...#.#.....#......................................#..........#.................
...........................#............#................#................#...........................#.....#.....................
.......#.................#..#..............#................................#....#........#.......#.............#....#....##......
........................................................#........................................................................#
.................#.........................................#.......#.......#......#...#.#.................##......................
..........#............#..............................................#........................................#..........#..#....
..............#......................................................#......#................................#....................
...#........#.............#.................#......#.......................#..............................##........#.............
.....................#............................................................#............#...............................#..
......#.....#..............................................................#...............#...#..................................
.......................................#..#.......#...#..............#.................................................#..........
...................................................................................................#........................#.....
....#.....#.......................................................#.....#......#...................#............#.................
..............#....#.....................#........................................##....#...#.....................................
.....#...............................................................#............#............................#..................
........................#..........................#..............................................................................
#..............#...........................................................................#......................................
...................................#...#....................................................................#.....................
................#......#.........#.................#...........................#..................................................
......#...#................#...............#..................................................#...................................
.......................#.............#..#....................#............#.......................................................
.....................#.#.....................................#................................##.............#.#..#..............#
.....................................#...#...........................#....................................................##...#..
.................#..#............#.............................#..#................................................##.............
...#...........................................#.................................................#.............#.............##...
..................#....#....#.#..........................#.............#................#............................#............
.........................#................#.#..#.#............^.........................................................#.........
.....#...............#............................................................................................................
.#.......................................................................................#...............#....#.............#.....
......#................................#............#............................................................#................
.#.....................#..............#.............#.......................#.....#....#.#.#...................#....#.............
..................................................................#........#............................#..#.#...............#....
.#.....................#......#........#.......#.................#.......................#..#.....................................
..............#..#..#.............................................#....................#......#...................................
.................##.#............................##..#...............................................................#....#.......
...........#..#........................#.#..........#.................##.....#...#.........................#.#...#............#...
.....................#..........#..#..............................................................................................
.......#...............................#..#.........#.....................................#......#...................#............
..............................##.#........#.......#..#.....#......................................................................
..................#......................#.....................................###...#............................##..............
...................................#...................................#...........................#....##..#.....................
.....................#.....#.#.........#.........................#.....#.......#..........#.......................#...............
...........#..................................................................................................#...................
......#............................#.............................#..........................................#.....##..............
...........................#...........................................................#.............................#..........#.
..........................................#..........................................#......#...............#.....................
..............##.........#........................................................................................................
.....................#............#..#......#..#......................................................................#...........
........#.........#.....................#.................................#...#.#....#....#......................#.#..............
......#...........#............................................................#..............#......................#............
.....#.....................#.....#.........#.............................#....#............................#......................
..#..............................................................................................................#...#............
..............#.......................#........#............................................#.......................#.............
........................................#....................................................................................##...
.......#..#.......#.................#.#.................#...........#............#........#.#.........#...........#.#..........#..
.....##.......................#.........................#.........................#...........#.........#.....#...........#.......
..........................#.....................#...............................#.............................#...................
.....#..........#.............#...#..........................#.#...................#...........................#......#...........
......................................#.......#.........#......................................#..................................
......#...#....................#................#...#.......#.............#............#...........#.....#........................
........................................#............#......................................................#............#........
..#.......#....#..........................................................................#......................##..#.......#....
................#...................................................#..........................................#..................
...........#........................................................................................#.............................
..................#........................................#.....#...........................#..................#.................
........#.......#.....#...........#.......................................................#.........#.............................
.............#.....#.#............................#...................................................................#...........
...............#...................................#...........................#.............#..#..................#..##..........
.#...............................#....#.....................#...................................#...................#...#.........
..................#..#.#..................................................................................................#.......
.........#.....#...#.........#........#...........................................#..................#.#.#......#.................
.........#......#.......................#........#.............................#...#................#...........................#.
...#.........................................................................................##........................#..........
.....................................#...........................................................#.#...#......#...............#...
#.....................#.........#.................................................#.....................................#.........
............##.............................#...............................................#......................................
.#.................#........................#.................................................................#.....#.............
.....#.......................#......................#.................#....#....................................................#.
.............................#..................................................................#.#...............................
........#.......#.....##..........................................#...................#.........#...........#...#...#...#.........
..........#.#...#.....................#............................................................##.........##..................
...................#..............##.....#...........#.#.......#................................................#...............#.
............................................................#....#.............#....##.......#...#...#................#...........
......#...............................#.........#...................#....#..............#.................#.......................
....................................#.....................#....#....#.................#...............#...........................
.................................#.............#.#...................................#..............#...#.....#.............#.....
......................#..................#.............#.................#................................................#.......
.....................##.......................#.............#...#........#..........#.....#............................##...#.....
..........................#.....................#...........#.....................................................#...............
................#.....................................................................................................#...........
........#......#.......................#....................................#................................#....................
.....................................#............................................................................................
........#..........#.........#.#................##................#...#..........................#.........#......##.......#......
.......#...................#................................#..#.......................#..............................#...........
............#.....................................#......#........................#..........#.............................#......
..#...........#...........#...................................#............#...#.....#......................................#.....
................................................................#...........#.......##.......#..........#............#............)"sv;
#pragma endregion


int day6(){
    constexpr std::string_view input = input6;
    std::vector<std::string> parsed6; 
    
    std::string row; 
    for (char c : input) {
        if (c == '\n') {
            if (!row.empty()) {
                parsed6.push_back(row); 
                row.clear(); 
            }
        } else {
            row += c; 
        }
    }
    if (!row.empty()) parsed6.push_back(row); 
    int h = parsed6.size();
    int w = parsed6[1].length();
    std::cout<< h << " wysokosc " << w <<" szerokosc"<<std::endl;
    for (const auto &para : parsed6) {
      for (auto i : para)
        std::cout<< i ;
     std::cout<<"\n"<<std::endl;
    }
    
    for (auto it = parsed6.begin(); it != parsed6.end(); ++it) {
      auto m = std::find(it->begin(), it->end(), '^');
      if (m != it->end()) {
        std::size_t row_index = std::distance(parsed6.begin(), it); 
        std::size_t col_index = std::distance(it->begin(), m);     
        std::cout << "Rząd: " << row_index << ", Kolumna: " << col_index << std::endl;
    }
   }
   int row_index =59;
   int col_index = 62;
   std::pair<int,int> pozycja;
   std::vector<std::pair<int, int>> pozycja_his;
   pozycja.first= row_index;
   pozycja.second= col_index;
   pozycja_his.push_back(std::move(pozycja));
   //std::cout<<pozycja[0]<<std::endl;
   int i =1;
   while(true){
     if(!(0<=row_index && row_index<129 && 0<=col_index && col_index<129) ){
        break;
     }
     
     if(parsed6[row_index][col_index] == '^'){
        if(parsed6[row_index-1][col_index] == '#'){
            parsed6[row_index][col_index] = '>';   
        }
        else{
          std::swap(parsed6[row_index-1][col_index],parsed6[row_index][col_index]);
          row_index--;
        }
     }
     if(parsed6[row_index][col_index] == '>'){
         if(  parsed6[row_index][col_index+1] == '#'){
            parsed6[row_index][col_index] = 'v';
           
        }
        else{
          std::swap(parsed6[row_index][col_index+1],parsed6[row_index][col_index]);
          col_index++;
        }
     } 
     if(parsed6[row_index][col_index] == '<'){
         if( parsed6[row_index][col_index-1] == '#'){
            parsed6[row_index][col_index] = '^';
            
        }
        else{
          std::swap(parsed6[row_index][col_index-1],parsed6[row_index][col_index]);
          col_index--;
        }
     }
     if(parsed6[row_index][col_index] == 'v'){
        if(parsed6[row_index+1][col_index] == '#'){
            parsed6[row_index][col_index] = '<';
            
        }
        else{
          std::swap(parsed6[row_index+1][col_index],parsed6[row_index][col_index]);
          row_index++;
        }
     }
     
     
     //std::cout<< row_index << " "<< col_index << std::endl;
    std::pair<int, int> para = {row_index, col_index};

    if(std::find(pozycja_his.begin(),pozycja_his.end(),para) == pozycja_his.end()){
         pozycja_his.push_back(para);
         i++;
     } 
   }
   std::cout<<"wyszedł poza granice "<< i <<std::endl;

  
  return 0;
}
int day6b(){
  constexpr std::string_view input = input6;
    std::vector<std::string> parsed6b; 
    
    std::string row; 
    for (char c : input) {
        if (c == '\n') {
            if (!row.empty()) {
                parsed6b.push_back(row); 
                row.clear(); 
            }
        } else {
            row += c; 
        }
    }
    if (!row.empty()) parsed6b.push_back(row); 
    int row_index =59;
    int col_index = 62;
    std::pair<int,int> pozycja;
    std::vector<std::pair<int, int>> pozycja_his;
    
    pozycja.first= row_index;
    pozycja.second= col_index;
    pozycja_his.push_back(std::move(pozycja));
    //std::cout<<pozycja[0]<<std::endl;
    int i =1;
    int j=0;
    int wynik = 0;
    bool flag1 =1;
    std::vector<std::pair<int, int>> dirs={{-1,0},{0,1},{1,0},{0,-1}};
  for (auto& para: parsed6b) {
      for (auto& i: para){
        //std::cout << i <<" "<<j << std::endl;
        int kroki =0;
        row_index = 59;
        col_index = 62;
        int powrot =0;
        if(i == '^' || i == '#'){
          continue;
        }
        if(i == '.'){
          i = '#';
        }
        /*for (const auto &para : parsed6b) {
             for (auto i : para)
             std::cout<< i ;
         std::cout<<"\n"<<std::endl;
        }*/
        //std::cout<<"grid"<<std::endl;
        std::unordered_set<int> pozycja_hash;
       while(true){
         if(!(0<row_index && row_index<129 && 0<col_index && col_index<129) ){
            //std::cout<<"wyszedł poza granice "<<std::endl;
            parsed6b[59][62] = '^';
            i ='.';
            parsed6b[row_index][col_index] = '.';
            break;
          }
         /*if(flag1 == 0){
          *i = '.';
          parsed6b[row_index][col_index] = '.';
          wynik++;
          break;
         }*/
         int dir =0;
         if(parsed6b[row_index][col_index] == '^'){
            dir=0;
           if(parsed6b[row_index-1][col_index] == '#'){
              parsed6b[row_index][col_index] = '>';  
            }
           else{
            std::swap(parsed6b[row_index-1][col_index],parsed6b[row_index][col_index]);
            row_index--;
           }
          }
         if(parsed6b[row_index][col_index] == '>'){
           dir=1;
           if(  parsed6b[row_index][col_index+1] == '#'){
              parsed6b[row_index][col_index] = 'v';
            }
          else{
            std::swap(parsed6b[row_index][col_index+1],parsed6b[row_index][col_index]);
            
            col_index++;
          }
         } 
         if(parsed6b[row_index][col_index] == '<'){
          dir=3;
           if( parsed6b[row_index][col_index-1] == '#'){
              parsed6b[row_index][col_index] = '^';
            }
         else{
          std::swap(parsed6b[row_index][col_index-1],parsed6b[row_index][col_index]);
          
          col_index--;
          }
        }
        if(parsed6b[row_index][col_index] == 'v'){
           dir=2;
           if(parsed6b[row_index+1][col_index] == '#'){
            parsed6b[row_index][col_index] = '<';   
          } 
          else{
          std::swap(parsed6b[row_index+1][col_index],parsed6b[row_index][col_index]);
          row_index++;
          }
        } 
        //std::cout<< row_index << " "<< col_index << std::endl;
        std::pair<int, int> para = {row_index, col_index};
    
         
           int hash = (row_index * 130 + col_index) * 4 + dir;
          
      
          if (pozycja_hash.find(hash) != pozycja_hash.end()) {
             powrot++;
           }
           if(powrot >400){
              // std::cout << "Utknął: (" << row_index << ", " << col_index << ") kierunek " << dir << std::endl;
             parsed6b[59][62] = '^';
             i = '.';
             parsed6b[row_index][col_index] = '.';
             wynik++;
             break;
           }
           pozycja_hash.insert(hash);
           kroki ++;
      }
     
    }     
  }
   
   
  std::cout<< wynik <<std::endl;



  return 0;
}